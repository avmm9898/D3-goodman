<!DOCTYPE html>
<html>

<head>
  <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
  <meta charset="utf-8">
  <title>Marker Clustering</title>
  <script src="https://d3js.org/d3.v4.min.js"></script>
  <style>
      /* Always set the map height explicitly to define the size of the div
       * element that contains the map. */
      #map {
        height: 100%;
      }
      /* Optional: Makes the sample page fill the window. */
      html, body {
        height: 100%;
        margin: 0;
        padding: 0;
      }
    </style>
</head>

<body>
  <div id="map"></div>
  <script>
    function initMap() {

      //var myLatLng = { lat: 25.043965, lng: 121.519581 };
      var locations = [];
      
      //locations[0]={ lat: 25.043965, lng: 121.519581 };

      var map = new google.maps.Map(document.getElementById('map'), {
        zoom: 4,
        center: { lat: 25.043965, lng: 121.519581 }
      });


      d3.csv("./hotspotlist.csv")
        .row(function (d) {
          return {
            LAT: +d.LAT,
            LNG: +d.LNG
          };
        })
        .get(function (error, csv) {
          if (!error) {
            // lets say you want to log all the temperatures to the console
            csv.forEach(function (d, i) {
              locations[i] = { lat: d.LAT, lng: d.LNG };
              // myLatLng.lat = d.LAT;
              //myLatLng.lng = d.LNG;

              /*var marker = new google.maps.Marker({
                position: myLatLng,
                map: map,
                title: 'Hello World!'
              });*/
            });
          };
        });
      //locations[1] = { lat: 25.00, lng: 121.5 };

      var markers = locations.map(function (location, i) {
        return new google.maps.Marker({
          position: location,
          //label: labels[i % labels.length]
        });
      });

      var markerCluster = new MarkerClusterer(map, markers,
        { imagePath: 'https://developers.google.com/maps/documentation/javascript/examples/markerclusterer/m' });
    }
    /*function initMap() {

      var map = new google.maps.Map(document.getElementById('map'), {
        zoom: 6,
        center: { lat: 25.043965, lng: 121.519581 }
      });

      // Create an array of alphabetical characters used to label the markers.
      var labels = 'â—Ž';

      // Add some markers to the map.
      // Note: The code uses the JavaScript Array.prototype.map() method to
      // create an array of markers based on a given "locations" array.
      // The map() method here has nothing to do with the Google Maps API.
      var markers = locations.map(function (location, i) {
        return new google.maps.Marker({
          position: location,
          label: labels[i % labels.length]
        });
      });

      // Add a marker clusterer to manage the markers.
      var markerCluster = new MarkerClusterer(map, markers,
        { imagePath: 'https://developers.google.com/maps/documentation/javascript/examples/markerclusterer/m' });
    }
    var locations = [{ lat: 25.043965, lng: 121.519581 }];
    d3.csv("./hotspotlist.csv",
      function (data) {
        console.log(data);
        locations.push({ lat: (function (d) { return d.LAT; }), lng: (function (d) { return d.LNG; } )});
        //locations.lng = function (d) { return d.LNG; };
      }
    );*/
  </script>
<script src="https://developers.google.com/maps/documentation/javascript/examples/markerclusterer/markerclusterer.js">
</script>
<script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDcISkkQ5wBGvYLnEj9Xr5cIqpE0N1nitM&callback=initMap">
</script>

</body>

</html>